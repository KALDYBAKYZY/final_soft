<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="
        http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.9.xsd">

    <!-- ================= USERS ================= -->
    <changeSet id="1" author="dev">
        <createTable tableName="users">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="full_name" type="VARCHAR(255)"/>
            <column name="email" type="VARCHAR(255)"/>
            <column name="password" type="VARCHAR(255)"/>
            <column name="role" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

    <!-- ================= AUTHORS ================= -->
    <changeSet id="2" author="dev">
        <createTable tableName="authors">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

    <!-- ================= CATEGORIES ================= -->
    <changeSet id="3" author="dev">
        <createTable tableName="categories">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

    <!-- ================= LANGUAGES ================= -->
    <changeSet id="4" author="dev">
        <createTable tableName="languages">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(100)"/>
        </createTable>
    </changeSet>

    <!-- ================= FORMATS ================= -->
    <changeSet id="5" author="dev">
        <createTable tableName="formats">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(100)"/>
        </createTable>
    </changeSet>

    <!-- ================= SERIES ================= -->
    <changeSet id="6" author="dev">
        <createTable tableName="series">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

    <!-- ================= TAGS ================= -->
    <changeSet id="7" author="dev">
        <createTable tableName="tags">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(100)"/>
        </createTable>
    </changeSet>

    <!-- ================= PUBLISHERS ================= -->
    <changeSet id="8" author="dev">
        <createTable tableName="publishers">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="VARCHAR(255)"/>
        </createTable>
    </changeSet>

    <!-- ================= BOOKS ================= -->
    <changeSet id="9" author="dev">
        <createTable tableName="books">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="title" type="VARCHAR(255)"/>
            <column name="description" type="TEXT"/>
            <column name="price" type="DOUBLE"/>
            <column name="author_id" type="BIGINT"/>
            <column name="category_id" type="BIGINT"/>
            <column name="publisher_id" type="BIGINT"/>
            <column name="language_id" type="BIGINT"/>
            <column name="format_id" type="BIGINT"/>
            <column name="series_id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <!-- ================= BOOK_TAGS ================= -->
    <changeSet id="10" author="dev">
        <createTable tableName="book_tags">
            <column name="book_id" type="BIGINT"/>
            <column name="tag_id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <!-- ================= REVIEWS ================= -->
    <changeSet id="11" author="dev">
        <createTable tableName="book_reviews">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="review_text" type="TEXT"/>
            <column name="rating" type="INT"/>
            <column name="user_id" type="BIGINT"/>
            <column name="book_id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <!-- ================= RATINGS ================= -->
    <changeSet id="12" author="dev">
        <createTable tableName="ratings">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="score" type="INT"/>
            <column name="user_id" type="BIGINT"/>
            <column name="book_id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <!-- ================= ORDERS ================= -->
    <changeSet id="13" author="dev">
        <createTable tableName="orders">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="created_at" type="TIMESTAMP"/>
            <column name="status" type="VARCHAR(50)"/>
        </createTable>
    </changeSet>

    <!-- ================= ORDER ITEMS ================= -->
    <changeSet id="14" author="dev">
        <createTable tableName="order_items">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="quantity" type="INT"/>
            <column name="price" type="DECIMAL(10,2)"/>
            <column name="book_id" type="BIGINT"/>
            <column name="order_id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <!-- ================= PAYMENTS ================= -->
    <changeSet id="15" author="dev">
        <createTable tableName="payments">
            <column name="id" type="BIGINT" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="amount" type="DECIMAL(10,2)"/>
            <column name="status" type="VARCHAR(50)"/>
            <column name="paid_at" type="TIMESTAMP"/>
            <column name="order_id" type="BIGINT"/>
        </createTable>
    </changeSet>

    <!-- ================= FOREIGN KEYS ================= -->
    <changeSet id="20" author="dev">
        <addForeignKeyConstraint baseTableName="books" baseColumnNames="author_id"
                                 referencedTableName="authors" referencedColumnNames="id"
                                 constraintName="fk_books_author"/>

        <addForeignKeyConstraint baseTableName="books" baseColumnNames="category_id"
                                 referencedTableName="categories" referencedColumnNames="id"
                                 constraintName="fk_books_category"/>

        <addForeignKeyConstraint baseTableName="books" baseColumnNames="publisher_id"
                                 referencedTableName="publishers" referencedColumnNames="id"
                                 constraintName="fk_books_publisher"/>

        <addForeignKeyConstraint baseTableName="books" baseColumnNames="language_id"
                                 referencedTableName="languages" referencedColumnNames="id"
                                 constraintName="fk_books_language"/>

        <addForeignKeyConstraint baseTableName="books" baseColumnNames="format_id"
                                 referencedTableName="formats" referencedColumnNames="id"
                                 constraintName="fk_books_format"/>

        <addForeignKeyConstraint baseTableName="books" baseColumnNames="series_id"
                                 referencedTableName="series" referencedColumnNames="id"
                                 constraintName="fk_books_series"/>

        <addForeignKeyConstraint baseTableName="book_tags" baseColumnNames="book_id"
                                 referencedTableName="books" referencedColumnNames="id"
                                 constraintName="fk_book_tags_book"/>

        <addForeignKeyConstraint baseTableName="book_tags" baseColumnNames="tag_id"
                                 referencedTableName="tags" referencedColumnNames="id"
                                 constraintName="fk_book_tags_tag"/>

        <addForeignKeyConstraint baseTableName="ratings" baseColumnNames="book_id"
                                 referencedTableName="books" referencedColumnNames="id"
                                 constraintName="fk_ratings_book"/>

        <addForeignKeyConstraint baseTableName="ratings" baseColumnNames="user_id"
                                 referencedTableName="users" referencedColumnNames="id"
                                 constraintName="fk_ratings_user"/>

        <addForeignKeyConstraint baseTableName="order_items" baseColumnNames="order_id"
                                 referencedTableName="orders" referencedColumnNames="id"
                                 constraintName="fk_order_items_order"/>

        <addForeignKeyConstraint baseTableName="order_items" baseColumnNames="book_id"
                                 referencedTableName="books" referencedColumnNames="id"
                                 constraintName="fk_order_items_book"/>

        <addForeignKeyConstraint baseTableName="payments" baseColumnNames="order_id"
                                 referencedTableName="orders" referencedColumnNames="id"
                                 constraintName="fk_payments_order"/>
    </changeSet>

    <!-- ================= INSERT DATA ================= -->
    <changeSet id="30" author="dev">
        <insert tableName="languages"><column name="name" value="English"/></insert>
        <insert tableName="languages"><column name="name" value="Russian"/></insert>

        <insert tableName="formats"><column name="name" value="Paperback"/></insert>
        <insert tableName="formats"><column name="name" value="Ebook"/></insert>

        <insert tableName="categories"><column name="name" value="Fantasy"/></insert>
        <insert tableName="publishers"><column name="name" value="Penguin"/></insert>
        <insert tableName="tags"><column name="name" value="Bestseller"/></insert>
    </changeSet>

</databaseChangeLog>
